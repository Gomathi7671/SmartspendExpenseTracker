<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Notifications</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body class="bg-light">
<div class="container mt-5">
    <h3 class="text-center text-primary mb-3">ðŸ”” Real-time Notifications</h3>

    <div id="notifications" class="list-group shadow-sm"></div>

    <div class="text-center mt-4">
        <a href="/overview" class="btn btn-outline-primary">Back to Dashboard</a>
    </div>
</div>

<script th:inline="javascript">
    const email = /*[[${session.email}]]*/ '';
    const socket = new SockJS('/ws');
    const stomp = Stomp.over(socket);

    stomp.connect({}, function () {
        stomp.subscribe('/topic/notifications/' + email, function (notification) {
            const msg = JSON.parse(notification.body) || notification.body;
            const alertDiv = document.createElement('div');
            alertDiv.classList.add('list-group-item', 'list-group-item-warning');
            alertDiv.textContent = msg;
            document.getElementById('notifications').prepend(alertDiv);
        });
    });
</script>
</body>
</html>
